source_up .envrc

# set alias in your .bashrc
# alias reset_profile='rm ${_profile_env}'"

export _id=$(basename $(/bin/pwd))
export _id_path=${_prov_path}/${_id}

# Set the account/project/subscription ID using provider-specific env var
export ${_id_env_var_name}=${_id}

# Handle profile if provider requires it (AWS and GCP need profiles, Azure does not)
if [[ "${_needs_profile}" == "true" ]]; then
    _profile_env_path=$HOME/.toolbelt/${_id_path}
    export _profile_env=${_profile_env_path}/.env

    if [[ ! -d ${_profile_env_path} ]]; then
        mkdir -p ${_profile_env_path}
    fi

    if [[ ! -f ${_profile_env} ]]; then
        read -p "${_prov_envvar_prefix} profile name: " profile_name
        echo "export _profile_name=$profile_name" > ${_profile_env}
    fi

    dotenv_if_exists ${_profile_env}

    export ${_profile_env_var_name}=${_id}_${_profile_name}

    export CUSTOM_PS1='\[\e[0;1;38;5;201m\]${_id}\[\e[0;1;38;5;231m\]_\[\e[0;1;38;5;39m\]${_profile_name}\[\e[0;1;38;5;82m\]->\W>\[\e[0m\]'
else
    export CUSTOM_PS1='\[\e[0;1;38;5;201m\]${_id}\[\e[0;1;38;5;82m\]->\W>\[\e[0m\]'
fi

